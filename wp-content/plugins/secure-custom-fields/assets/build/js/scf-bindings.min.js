(()=>{"use strict";const e=window.wp.blocks,t=window.wp.coreData;(0,e.registerBlockBindingsSource)({name:"acf/field",label:"SCF Fields",getValues({context:e,bindings:n,select:r}){const{getEditedEntityRecord:a}=r(t.store),o=(e=>{if(!e?.acf)return{};const t={};return Object.entries(e.acf).forEach((([e,n])=>{if(e.endsWith("_source")){const r=e.replace("_source","");t[r]=n}})),t})(e?.postType&&e?.postId?a("postType",e.postType,e.postId):void 0),c={};return Object.entries(n).forEach((([e,{args:t}={}])=>{const n=((e,t,n)=>{const r=t?.key,a=n[r];if(!a)return"";const o=a.type,c=a.formatted_value;switch(o){case"image":return((e,t)=>{if(!e)return"";switch(t){case"url":return e.url||"";case"alt":return e.alt||"";case"title":return e.title||"";case"id":return e.id||e.ID||"";default:return""}})(c,e);case"checkbox":return Array.isArray(c)?c.join(", "):c?c.toString():"";default:return c?c.toString():""}})(e,t,o);c[e]=n})),c},canUserEditValue:()=>!1});const n=window.wp.element,r=window.wp.hooks,a=window.wp.compose,o=window.wp.blockEditor,c=window.wp.components,s=window.wp.i18n,l=window.wp.data,i=window.wp.editor,u={"core/paragraph":{content:["text","textarea","date_picker","number","range"]},"core/heading":{content:["text","textarea","date_picker","number","range"]},"core/image":{id:["image"],url:["image"],title:["image"],alt:["image"]},"core/button":{url:["url"],text:["text","checkbox","select","date_picker"],linkTarget:["text","checkbox","select"],rel:["text","checkbox","select"]}};const d=(0,a.createHigherOrderComponent)((e=>r=>{const a=function(e){const t=u[e];return t?Object.keys(t):[]}(r.name),{updateBlockBindings:d,removeAllBlockBindings:m}=(0,o.useBlockBindingsUtils)(),f=(0,l.useSelect)((e=>{const{getEditedEntityRecord:n}=e(t.store),{getCurrentPostType:r,getCurrentPostId:a}=e(i.store),o=r(),c=a();if(!o||!c)return{};const s=n("postType",o,c),l={};return Object.entries(s?.acf||{}).forEach((([e,t])=>{if(e.endsWith("_source")){const n=e.replace("_source","");s?.acf.hasOwnProperty(n)&&(l[n]=t)}})),l}),[]),p=(0,n.useCallback)(((e=null)=>{if(!f||0===Object.keys(f).length)return[];const t=u[r.name];let n=null;return t&&(n=e?t[e]:Object.values(t).flat()),Object.entries(f).filter((([,e])=>!n||n.includes(e.type))).map((([e,t])=>({value:e,label:t.label})))}),[f,r.name]),g=(0,n.useMemo)((()=>{if(!a||a.length<=1)return!1;const e=u[r.name];if(!e)return!1;const t=e[a[0]]||[];return a.every((n=>{const r=e[n]||[];return r.length===t.length&&r.every((e=>t.includes(e)))}))}),[a,r.name]),[b,w]=(0,n.useState)({});(0,n.useEffect)((()=>{const e=r.attributes?.metadata?.bindings||{},t={};Object.keys(e).forEach((n=>{e[n]?.args?.key&&(t[n]=e[n].args.key)})),w(t)}),[r.attributes?.metadata?.bindings]);const h=(0,n.useCallback)(((e,t)=>{if(Array.isArray(e)){const n={...b},r={};e.forEach((e=>{n[e]=t,r[e]=t?{source:"acf/field",args:{key:t}}:void 0})),w(n),d(r)}else w((n=>({...n,[e]:t}))),d({[e]:t?{source:"acf/field",args:{key:t}}:void 0})}),[b,d]),_=(0,n.useCallback)((()=>{m(),w({})}),[m]);return 0!==p().length&&a?React.createElement(React.Fragment,null,React.createElement(o.InspectorControls,r,React.createElement(c.__experimentalToolsPanel,{label:(0,s.__)("Connect to a field","secure-custom-fields"),resetAll:_},g?React.createElement(c.__experimentalToolsPanelItem,{hasValue:()=>!!b[a[0]],label:(0,s.__)("All attributes","secure-custom-fields"),onDeselect:()=>h(a,null),isShownByDefault:!0},React.createElement(c.ComboboxControl,{label:(0,s.__)("Field","secure-custom-fields"),placeholder:(0,s.__)("Select a field","secure-custom-fields"),options:p(),value:b[a[0]]||"",onChange:e=>h(a,e),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})):a.map((e=>React.createElement(c.__experimentalToolsPanelItem,{key:`scf-field-${e}`,hasValue:()=>!!b[e],label:e,onDeselect:()=>h(e,null),isShownByDefault:!0},React.createElement(c.ComboboxControl,{label:e,placeholder:(0,s.__)("Select a field","secure-custom-fields"),options:p(e),value:b[e]||"",onChange:t=>h(e,t),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})))))),React.createElement(e,r)):React.createElement(e,r)}),"withCustomControls");window.scf?.betaFeatures?.connect_fields&&(0,r.addFilter)("editor.BlockEdit","secure-custom-fields/with-custom-controls",d)})();